@model TimeTableViewModel

@{
    ViewData["Title"] = "Create Time Table";
}

<div class="container mt-4">
    <h2 class="text-center text-primary mb-4">Create Time Table</h2>

    <div class="card shadow p-4">
        <form id="timeTableForm" asp-action="Generate" method="post" class="needs-validation" novalidate>
            <div class="mb-3">
                <label class="form-label fw-bold">Working Days:</label>
                <input id="workingDays" asp-for="WorkingDays" type="number" class="form-control" min="1" max="7" required />
                <div class="invalid-feedback">Please enter a valid number between 1 and 7.</div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Subjects Per Day:</label>
                <input id="subjectsPerDay" asp-for="SubjectsPerDay" type="number" class="form-control" min="1" max="9" required />
                <div class="invalid-feedback">Please enter a valid number between 1 and 9.</div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Total Hours:</label>
                <input id="totalHours" type="number" class="form-control" readonly />
            </div>

            <h3 class="mt-4 text-secondary">Subjects</h3>
            <div id="subjectsContainer" class="mb-3"></div>
            <div id="hoursValidationMessage" class="text-danger fw-bold"></div>

            <div class="text-center">
                <button type="button" class="btn btn-info me-2" onclick="generateSubjectInputs()">Generate Subjects</button>
                <button type="submit" class="btn btn-primary" id="submitButton" disabled>Submit</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('workingDays').addEventListener('input', updateTotalHours);
        document.getElementById('subjectsPerDay').addEventListener('input', updateTotalHours);
        document.getElementById('timeTableForm').addEventListener('submit', validateForm);
    });

    function updateTotalHours() {
        let workingDays = parseInt(document.getElementById('workingDays').value) || 0;
        let subjectsPerDay = parseInt(document.getElementById('subjectsPerDay').value) || 0;
        let totalHours = workingDays * subjectsPerDay;
        document.getElementById('totalHours').value = totalHours > 0 ? totalHours : '';
    }

    function generateSubjectInputs() {
        let workingDays = parseInt(document.getElementById('workingDays').value);
        let subjectsPerDay = parseInt(document.getElementById('subjectsPerDay').value);
        let totalHours = workingDays * subjectsPerDay;

        if (workingDays < 1 || workingDays > 7 || subjectsPerDay < 1 || subjectsPerDay > 9) {
            alert("Please enter valid Working Days (1-7) and Subjects Per Day (1-9).");
            return;
        }

        document.getElementById('totalHours').value = totalHours;
        let container = document.getElementById('subjectsContainer');
        container.innerHTML = '';

        for (let i = 0; i < 4; i++) {
            let div = document.createElement('div');
            div.classList.add("mb-2");
            div.innerHTML = `
                <div class="input-group">
                    <input type="text" name="Subjects[${i}].Name" class="form-control" placeholder="Subject Name" required />
                    <input type="number" name="Subjects[${i}].Hours" class="form-control subjectHours" placeholder="Hours" min="1" required oninput="validateTotalHours()" />
                </div>
            `;
            container.appendChild(div);
        }

        document.getElementById('submitButton').disabled = true;
    }

    function validateTotalHours() {
        let totalHours = parseInt(document.getElementById('totalHours').value);
        let subjectHourInputs = document.querySelectorAll('.subjectHours');
        let enteredTotal = Array.from(subjectHourInputs).reduce((sum, input) => sum + (parseInt(input.value) || 0), 0);

        let validationMessage = document.getElementById('hoursValidationMessage');
        if (enteredTotal < totalHours) {
            validationMessage.innerText = `Total entered hours (${enteredTotal}) is less than required (${totalHours}).`;
            document.getElementById('submitButton').disabled = true;
        } else if (enteredTotal > totalHours) {
            validationMessage.innerText = `Total entered hours (${enteredTotal}) exceeds required (${totalHours}).`;
            document.getElementById('submitButton').disabled = true;
        } else {
            validationMessage.innerText = "";
            document.getElementById('submitButton').disabled = false;
        }
    }

    function validateForm(event) {
        validateTotalHours();
        if (document.getElementById('submitButton').disabled) {
            event.preventDefault();
        }
    }
</script>
